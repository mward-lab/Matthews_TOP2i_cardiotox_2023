---
title: "Renee_DRC_Code"
author: "ERM"
date: "`r Sys.Date()`"
output: html_document: 
    toc: yes
    theme: flatly
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is my Dose Response Curve Code and data with summaries.  
I hope to explain what and how I did things for future analysis, so that the code and data are reproducible.
All data was created by treating cardiomyocytes at \~day 26 of diff with 0.01-50 \muM concentrations of the drugs:
Daunorubicin (daun)
Doxorubicin (doxo)
Epirubicin (epi)
Mitoxantrone (mito)
Trastuzumab (tras)  [ note:  Trastuzumab could only be used at concentrations of 10 uM and lower]
Vehicle (veh)


Vehicle is the control and is effectively treated by water in volumes equivalent to the volume used to dilute the drugs in a 10 mM stock concentration.   This is why it has values at different concentrations and why I analyze the data this way.


Cell viability was assessed using Presto Blue reagent according to manufacturer's protocols.  
90 uL of Galactose media + 10 uL of Presto Blue reagent were added to each well of the 96 well DRC plate for one hour.  The cell media was then extracted to a black, clear bottom plate and wrapped in foil and stored at 4 degrees overnight (to allow bubbles to go away).  A plate reader was used to measure florescence and the RFLU values were exported to an excel file.


Analysis was done as follows:  The background wells were averaged and the average value was subtracted from every well on the plate.  Because the wells on the plate were randomized, Matching the treatment with the wells is critical and was done inefficiently in an excel file for each experiment.  
Percent Viability was calculated by averaging the RFLU from the vehicle at each concentration, and dividing each drug's RFLU at that concentration by the Vehicle control average RFLU to give a ratio.  All values less than 0 were turned into zero in the excel document, and a final compilation for each differentiation and dose curve treatment was stored in an document called DRC_compilation.xlsx. ( note: I spelled incorrectly in my computer)
For calculation to control for plate to plate variance, the "Empty_Blank" well RFLU2 values from each plate within an experiment were averaged.  
eg:  
plate 1= empty average RFLU2 = 29000,  plate 2 empty average RFLU2 =31000
normalized ratio  plate 1/plate 2
or 29000/31000 =0.9355
this normalization ratio then was divided into every RFLU2 value on plate 1.  Plate 2 would be divided by 1 to keep the formulas consistent (31000/31000 or plate2/plate2) to create a column that contained the adjusted RFLU2 values, called "adj"

Calculations then proceed as described originally.

the first viability value is called "Percent".  The adjusted value for intra-plate differences is called "Padj"  

Part 2 of the analysis of data begins by entering data from the excel compilation to R.

Step one in R is loading the libraries needed for analysis:

```{r Libraries to load, echo=TRUE, message=FALSE, warning=FALSE}
library(car)
#library(dr4pl)
library(tidyverse)
library(tinytex)
library(readxl)
library(BiocGenerics)
library(data.table)
library(drc)
library(Hmisc)
library(cowplot)
library(grid)
library(ggsignif)

```

Step 2 is importing the data from the DRC_compilation.xlsx file.  Future ref will refer to the table.

```{r data import, echo=FALSE, warning=FALSE}


D04_75_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD04_75-1n")
D05_75_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD05_75-1n")
D04_87_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD04_87-1n")
D05_87_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD05_87-1n")
    
D02_77_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD02_77-1")
D03_77_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD03_77-1")
D01_78_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD01_78-1")
D04_79_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD04_79-1")
D05_79_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD05_79-1")

D03_78_1 <- read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD03_78-1")

D02_71_1 <-read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMD02_71-1")

DJAG_71_1 <-read_excel("~/Ward Lab/Cardiotoxicity/Data/Cell viability/DRC_compilation.xlsx", 
    sheet = "PB CMDJAG_71-1")



```

Step 3:

The files "should" have a list of similar names:\
'Drug' which is the short name of drug used
'Conc' which is the concentration of drug added (in microMolar)
'Sname' the abbreviated name of Drug and Conc
'Well' letter with two number format
'Row' \# 1-8 for A-G 
'Column' numbers 1-12 
'Plate' will vary between two and three
'RFLU' the RFLU from the 0 hour reading with background subtracted (not all experiments have them)
'RFLU2'  the  RFLU from the 48 hour reading with background subtracted 

I will first streamline the data into more simple formats: 
Individual 1 is cell line 75-1 (D04_75_1,D05_75_1 )

Individual 2 is cell line 87-1 (D04_87_1, D05_87_1)

Individual 3 is cell line 77-1 (D02_77_1, D03_77_1)

Individual 4 is 79-1 (D04_79_1, D05_79_1)

Individual 5 is 78-1 (D01_78_1, D03_78_1)

Individual 6 is 71-1 (D02_71_1, DJAG_71_1)

As of 6-2-22 I am implementing a new naming for R handles:\
ind1a, ind1b etc, to make sure I process out the "empty_blanks"

I am also converting Conc column to numeric
Part 4: 
###file cleanup###

```{r File Cleanup, message=FALSE, warning=FALSE, include=FALSE}

ind1a <- as.data.frame(subset(D04_75_1, !(Drug %in% 'Empty')))
ind1b <- as.data.frame(subset(D05_75_1, !(Drug %in% 'Empty')))
ind2a <- as.data.frame(subset(D04_87_1, !(Drug %in% 'Empty')))
ind2b <- as.data.frame(subset(D05_87_1, !(Drug %in% 'Empty')))
ind3a <- as.data.frame(subset(D02_77_1, !(Drug %in% 'Empty')))
ind3b <- as.data.frame(subset(D03_77_1, !(Drug %in% 'Empty')))
ind4a <- as.data.frame(subset(D04_79_1, !(Drug %in% 'Empty')))
ind4b <- as.data.frame(subset(D05_79_1, !(Drug %in% 'Empty')))
ind5a <- as.data.frame(subset(D01_78_1, !(Drug %in% 'Empty')))
ind5b <- as.data.frame(subset(D03_78_1, !(Drug %in% 'Empty')))
ind6a <- as.data.frame(subset(D02_71_1, !(Drug %in% 'Empty')))
ind6b <- as.data.frame(subset(DJAG_71_1, !(Drug %in% 'Empty')))


ind1a <- ind1a %>%  mutate_at("Conc", as.numeric) %>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind1b <- ind1b %>%  mutate_at("Conc", as.numeric) %>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)

ind2a <- ind2a %>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind2b <- ind2b%>%  mutate_at("Conc", as.numeric)%>% 
  dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind3a <- ind3a%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind3b <- ind3b%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind4a <- ind4a %>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind4b <- ind4b%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind5a <- ind5a%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind5b <- ind5b%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind6a <- ind6a%>%  mutate_at("Conc", as.numeric)%>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)
ind6b <- ind6b %>%  mutate_at("Conc", as.numeric) %>% dplyr::select(Drug,Conc,Percent,Name) %>% drop_na(Percent)




```

File cleanup first subsets each file imported by taking out the 'Empty' samples in the Drug column and then renaming the file to individual names and DRC a and b

I then need to convert the concentrations to as.numeric and select the 5 columns that I really need for analysis, followed by dropping any wells that were NA in the Percent column.  
The next part of the code is to make analysis files and groups and things for the iterations.

The data-frame called individuals is complied from each of the dataframes wrangled above.

###lists
```{r combine list, echo=FALSE, message=FALSE, warning=FALSE}
###compile the separate data frames into a list of data frames
individuals <- list(ind1a,  
                    ind1b,
                    ind2a,
                    ind2b,
                    ind3a,
                    ind3b,
                    ind4a,
                    ind4b,
                    ind5a,
                    ind5b,
                    ind6a,
                    ind6b)

###First way to label data in the list with its' name
####adds the names to dataframe list
names(individuals) <- c("ind1a",
                          'ind1b',
                          'ind2a',
                          'ind2b',
                          "ind3a",
                          "ind3b",
                          "ind4a",
                          "ind4b",
                          "ind5a",
                          "ind5b",
                          "ind6a",
                          "ind6b")
###creates a list called ID which holds the names if needed
ID <- c("ind1a",
        'ind1b',
        'ind2a',
        'ind2b',
        "ind3a",
        "ind3b",
        "ind4a",
        "ind4b",
        "ind5a",
        "ind5b",
        "ind6a",
        "ind6b")
names(individuals)
full_list <- data.table::rbindlist(individuals, idcol = "SampleID")
 write.csv(full_list,"LDH48hoursdata.csv")
 ##make a smaller data frame###
 spec_ind <-  c("ind1a", "ind2b", "ind3b", "ind4b", "ind5b", "ind6a")### used to genrate ldh poster data in Dec 2022
 spec2_ind <-  c("ind1a", "ind2b", "ind3b", "ind4b", "ind5a", "ind6a")
 smaller <- individuals[c(1,4,6,7,9,11)]
 smaller2 <- individuals[c(1,3,6,7,9,11)]
 
smaller <- bind_rows(smaller,.id="SampleID")
smaller2 <- bind_rows(smaller2,.id="SampleID")
#saveRDS(individuals, file = "data/individualDRCfile.RDS")

```
##find the individuals rds
Once they are all in a data from, a few functions need to be defined for ggplot:
##functions
 

```{r empty list holder, include=FALSE}

#### making lists to put stuff in###
daunls <- list() ###daunorubicin list
doxols <- list() ### doxorubicin list
epils <- list() ###epirubicin list
mitols <- list() ###mitoxantrone list
trasls <- list() ###trastuzmab list
vehls <- list() ###vehicle list
name <- c( "Veh","Daun", "Doxo","Epi", "Mito", "Tras")### text list of drugs
```

## Individual Plots
```{r individual plots, eval=FALSE, include=FALSE}

for (i in name){
  thing <- subset(rbind(ind5a), Drug == i)
    label.1 <- thing$Name[1]
    thing.m <- dr4pl(Percent ~ Conc, data = thing, method.init = "logistic",init.parm = dr4pl_theta(NA,NA,NA,0))
    #doxols[[i]] <- summary(thing.m)
    pl <- plot(thing.m,
              ylim = c(0,1.2),
      text.x ="Concentration",
      text.y = "Percent Viable",
      text.title = label.1)
    
  pl$i
    
    print(summary(thing.m))
    pl <- pl  + ylim(0, 1.2)+ geom_point(size = 0.01)
    plot(pl)
    
    ###how I change the limits and colors of dots?)
} 
 
pl$i

```
The problem with that package is the  dots.... and the fact I cannot graph lines on top of one another.  So I started to extract the information needed to generate the geom_ribbon and geom_line data needed.

Here I need to assign the drugs out by drug:

```{r making filtered data, echo=FALSE}

### sort drug out and store as drug name from smaller list
#unique(smaller$SampleID)
#returns "ind1a" "ind2b" "ind3b" "ind4b" "ind5a" "ind6a"
DA <- full_list[Drug =="Daun"]
DX <- full_list[Drug =="Doxo"]
EP <- full_list[Drug =="Epi"]
MT <- full_list[Drug =="Mito"]
TR <- full_list[Drug =="Tras"]
VE <- full_list[Drug =="Veh"]
DA2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug == "Daun")
DX2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug == "Doxo")
EP2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug =="Epi")
MT2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug =="Mito")
TR2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug =="Tras")
VE2 <- smaller2 %>% na.omit %>%dplyr::filter(Drug == "Veh")
#####Then add names!
```


```{r Daunorubicin, eval=FALSE, include=FALSE}
### to extract parameters for mapping
param_holder <- c()
for (i in ID) {
  thing <- filter(DA, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- thing.m$parameters[2]
  
   
}
DA_parm <- param_holder
    ```
    
```{r Doxorubicin, eval=FALSE, include=FALSE}
### to extract parameters for mapping
param_holder <- c()
for (i in ID) {
  thing <- filter(DX, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- thing.m$parameters[2]
  
   
}
DX_parm <- as.data.frame(param_holder)
    ```
    
```{r Epirubicin,eval=FALSE, include=FALSE}
### to extract parameters for mapping
param_holder <- c()
for (i in ID) {
  thing <- filter(EP, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- thing.m$parameters[2]
  
   
}
EP_parm <- as.data.frame(param_holder)
    ```
    
```{r Mitoxantrone,eval=FALSE, include=FALSE}
### to extract parameters for mapping
param_holder <- c()
for (i in ID) {
  thing <- filter(MT, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- thing.m$parameters[2]
  
   
}
MT_parm <- as.data.frame(param_holder)
    ```
    
    

####Viability

I wanted to graph viability across all samples.  Below are the results from a sample of concentrations.
    
```{r Viablitiy plots, eval=FALSE, include=FALSE,warning=FALSE}
### to extract parameters for mapping
DAvia <- full_list %>% filter(Drug == "Daun") %>% filter(Conc ==0.5)# %>% mutate(SampleID=substr(SampleID,1,4))
DXvia <- full_list %>% filter(Drug == "Doxo")%>% filter(Conc ==0.5) %>% mutate(SampleID=substr(SampleID,1,4))
EPvia <- full_list %>% filter(Drug =="Epi")%>% filter(Conc ==0.5) %>% mutate(SampleID=substr(SampleID,1,4))
MTvia <- full_list %>% filter(Drug =="Mito")%>% filter(Conc ==0.5) %>% mutate(SampleID=substr(SampleID,1,4))
TRvia <- full_list %>% filter(Drug =="Tras")%>% filter(Conc ==0.5) %>% mutate(SampleID=substr(SampleID,1,4))
VEvia <- full_list %>% filter(Drug == "Veh")%>% filter(Conc ==0.5) %>% mutate(SampleID=substr(SampleID,1,4))
values_48_list <- full_list %>% na.omit()%>% filter(Conc == 0.5) %>% mutate(SampleID=substr(SampleID,1,4)) 

       
      #plot.background = element_rect(fill = "#DDBBCD", colour = NA))
#refmt <- MT[SampleID=='ind6a']
ggplot(VE, aes(x= as.factor(Conc), y= Percent)) +
     guides(alpha = "none")+ 
      # stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "errorbar", size =1, width = 1)+
  geom_boxplot(position ="dodge")+
      ylim(0,1.5)+
  facet_wrap(~SampleID)
    ```
    
```{r Viability data, echo=FALSE, warning=FALSE}
### to extract parameters for mapping
drug_pal_fact <- c("#8B006D","#DF707E","#F1B72B", "#3386DD","#707031","#41B333")
alterlist <- full_list %>% 
      na.omit()%>% 
      filter(Conc ==0.5|Conc==0.05|Conc ==5) %>%
      mutate(indv=substr(SampleID,4,4)) %>% 
      mutate(indv=factor(as.numeric(indv))) %>% 
  mutate(Drug = factor(Drug, levels = c("Daunorubicin",  
                                        "Doxorubicin",
                                        "Epirubicin",
                                        "Mitoxantrone",
                                        "Trastuzumab",
                                        "Vehicle")))  

ggplot(alterlist,  aes(x= as.factor(Conc), y= Percent, group = Conc)) +
  geom_boxplot(position="dodge",outlier.colour="transparent", aes(fill=Name))+
  geom_point(aes(color=indv))+
  guides(alpha = "none")+
  ylim(0,1.5)+
   scale_color_brewer(palette = "Dark2",guide="legend",name = "Individual",labels(c(1,2,3,4,5,6)))+
  scale_fill_manual(values=drug_pal_fact)+
  theme_classic() +
  xlab(expression(paste("Concentration [", mu, "M]")))+
  geom_hline(yintercept = 1,lty = 4)+
  ylab("Viability") +
  facet_wrap(~Name)+
  ggtitle("Viablity across concentrations at 48 hours")+
  theme(axis.title=element_text(size=10),
        axis.ticks=element_line(size =2),
        axis.text=element_text(size=9, face = "bold"),
       panel.grid.major = element_line(colour = 'darkgrey'),
       panel.border=element_rect(fill = NA, size = 2),
       plot.title = element_text(hjust = 0.5, size =15, face = "bold"))
   
```   
    
```{r daunplot, echo=FALSE, message=FALSE, warning=FALSE}
# ggplot(DA2, aes(x=Conc, y= Percent, color = SampleID, alpha =0.6)) +
#      guides(color =  "none", alpha = "none")+
#       stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "pointrange", size =0.8)+
#     stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,1.0,0,NA))), se = FALSE)+
#       ylim(0,1.5)+
#       scale_x_log10() +  # Change the x-axis scale to log 10 scale
#   theme_classic() +
#   xlab(expression(paste("Concentration [", mu, "M]")))+
#   ylab("Normalized Cell Viability")


daplot <- ggplot(DA2, aes(x=Conc, y= Percent, color = SampleID,alpha =0.4)) +
     guides(color="none", alpha = "none")+
      stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
    stat_smooth(method = "drm", 
                method.args = list(fct = L.4(c(NA,0,1,NA))), se = FALSE)+
    ylim(0,1.5)+
    scale_color_brewer(palette = "Dark2")+
    scale_x_log10() +  # Change the x-axis scale to log 10 scale
    theme_classic() +
    xlab(expression(paste("Concentration [", mu, "M]")))+
    ylab(NULL) +
    ggtitle("Daunorubicin")+
    theme(plot.title = element_text(hjust = 0.5, size =15, face = "bold"),
          axis.title=element_text(size=10),
          axis.ticks=element_line(linewidth =2),
          axis.text=element_text(size=10, face = "bold"),
          panel.grid.major = element_line(colour = 'lightgrey'),
          panel.border=element_rect(fill = NA, linewidth = 2),
          plot.background = element_rect(fill = "#DDBBCD", colour = NA))
      
  daplot
  # theme(plot.title = element_text(hjust = 0.5, size =20))
    
    ```
    
```{r doxplot, echo=FALSE, message=FALSE, warning=FALSE}
# ggplot(DX2, aes(x=Conc, y= Percent, colour = SampleID,alpha =0.6)) +
#   guides( alpha = "none")+
#       stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "pointrange", size =0.8)+
#     stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,1.0,0,NA))), se = FALSE)+
#       ylim(0,1.5)+
#       scale_x_log10() +  # Change the x-axis scale to log 10 scale
#   theme_classic() +
#   xlab(expression(paste("Concentration [", mu, "M]")))+
#   ylab("Normalized Cell Viability")

dxplot <-
  ggplot(DX2, aes(x=Conc, y= Percent, color = SampleID,alpha =0.6)) +
  guides(color="none", alpha = "none")+
      stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
      stat_smooth(method = "drm", 
                  method.args = list(fct = L.4(c(NA,1,0,NA))), 
                  se = FALSE)+
      ylim(0,1.5)+
      scale_color_brewer(palette = "Dark2")+
      scale_x_log10() +  # Change the x-axis scale to log 10 scale
      theme_classic() +
      xlab(expression(paste("Concentration [", mu, "M]")))+
      ylab(NULL) +
      theme(plot.title = element_text(hjust = 0.5, size =15, face ="bold"))+
      ggtitle("Doxorubicin")+
      theme(axis.title=element_text(size=10),
            axis.ticks=element_line(linewidth = 2),
            axis.text=element_text(size=10, face = "bold"),
            panel.grid.major = element_line(colour = 'lightgrey'),
            panel.border=element_rect(fill = NA, linewidth = 2),
            plot.background = element_rect(fill = "#DDBBCD", colour = NA))
      
  # theme(plot.title = element_text(hjust = 0.5, size =20))
    
    dxplot
    
    ```
    
    
    
    
    
```{r epiplot,echo=FALSE, message=FALSE, warning=FALSE}
ggplot(EP2, aes(x=Conc, y= Percent, color = SampleID, alpha =0.6)) +
  guides(color =  "none", alpha = "none")+
  stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "pointrange", size =0.8)+
    stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,NA,NA,NA))), se = FALSE)+
      ylim(0,1.5)+
      scale_x_log10() +  # Change the x-axis scale to log 10 scale
  theme_classic() +
  xlab(expression(paste("Concentration [", mu, "M]")))+
  ylab("Normalized Cell Viability")

epplot <- 
  ggplot(EP2, aes(x=Conc, y= Percent, color = SampleID, alpha =0.6)) +
  guides(color="none", alpha = "none")+
  stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
  stat_smooth(method = "drm", 
                method.args = list(fct = L.4(c(NA,0,1,NA))), 
                se = FALSE)+
  ylim(0,1.5)+
  scale_x_log10() +  # Change the x-axis scale to log 10 scale
  theme_classic() +
  scale_color_brewer(palette = "Dark2")+
  xlab(expression(paste("Concentration [", mu, "M]")))+
  ylab(NULL) +
  theme(plot.title = element_text(hjust = 0.5, size =15, face ="bold"))+
  ggtitle("Epirubicin")+
  theme(axis.title=element_text(size=10),
        axis.ticks=element_line(linewidth = 2),
        axis.text=element_text(size=10, face = "bold"),
        panel.grid.major = element_line(colour = 'lightgrey'),
        panel.border=element_rect(fill = NA, linewidth = 2),
        plot.background = element_rect(fill = "#DDBBCD", colour = NA))
      
  # theme(plot.title = element_text(hjust = 0.5, size =20))
  epplot  
    
    
    ```
    
    
```{r Mitoplot, echo=FALSE, message=FALSE, warning=FALSE}
# ggplot(MT2, aes(x=Conc, y= Percent, color = SampleID, alpha= 0.6)) +
#      guides(color =  guide_legend(overide.aes =list(size=4)), alpha = "none")+
#       stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "pointrange", size =0.8)+
#     stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,0,NA,NA))), se = FALSE)+
#       ylim(0,1.5)+
#       scale_x_log10() +  # Change the x-axis scale to log 10 scale
#   theme_classic() +
#   xlab(expression(paste("Concentration [", mu, "M]")))+
#   ylab()
      
    
mtplot <- 
  ggplot(MT2, aes(x=Conc, y= Percent, color = SampleID, alpha=0.6))+
      guides(color="none", alpha = "none")+
      stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
      stat_smooth(method = "drm", 
                  method.args = list(fct = L.4(c(NA,0,1,NA))), 
                  se = FALSE)+
      ylim(0,1.5)+
      scale_x_log10() + 
      scale_color_brewer(palette = "Dark2")+# Change the x-axis scale to log 10 scale
      theme_classic() +
      xlab(expression(paste("Concentration [", mu, "M]")))+
      ylab(NULL) +
      theme(plot.title = element_text(hjust = 0.5, size =15, face="bold"))+
      ggtitle("Mitoxantrone")+
      theme(axis.title=element_text(size=10),
            axis.ticks=element_line(linewidth = 2),
            axis.text=element_text(size=10, face = "bold"),
            panel.grid.major = element_line(colour = 'lightgrey'),
            panel.border=element_rect(fill = NA, linewidth =  2),
            plot.background = element_rect(fill = "#FFD966", colour = NA))
      
      
  # theme(plot.title = element_text(hjust = 0.5, size =20))
  mtplot  
    
    
    ```
    
    
    
```{r  trasplot}
 leg <- ggplot(TR2, aes(x=Conc, y= Percent, color = SampleID, alpha = 0.6)) +
          geom_line()+
          theme_classic() +
      scale_color_brewer(palette = "Dark2",labels = c("1", "2", "3","4","5","6"))+
        labs(color = "Individual", linewidth=3)
        
          
library(RColorBrewer)    
   leg
   
trplot <- 
  ggplot(TR2, aes(x=Conc, y= Percent, color = SampleID, alpha = 0.6)) +
      guides(color="none", alpha = "none")+
      stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
      stat_smooth(method = "drm", 
                  method.args = list(fct = L.4(c(NA,0,1,NA))), se = FALSE)+
      ylim(0,1.5)+
      scale_x_log10() +  # Change the x-axis scale to log 10 scale
      theme_classic() +
      scale_color_brewer(palette = "Dark2")+
      xlab(expression(paste("Concentration [", mu, "M]")))+
      ylab(NULL) +
      theme(plot.title = element_text(hjust = 0.5, size =15, face = "bold"))+
      ggtitle("Trastuzumab")+
      theme(axis.title=element_text(size=10),
            axis.ticks=element_line(size =2),
            axis.text=element_text(size=10, face = "bold"),
            panel.grid.major = element_line(colour = 'lightgrey'),
            panel.border=element_rect(fill = NA, size = 2),
            plot.background = element_rect(fill = "#FFD966", colour = NA))
      
  # theme(plot.title = element_text(hjust = 0.5, size =20))
  trplot  

    
    
    ```
    
    
```{r control plot, echo=, message=FALSE, warning=FALSE}
# ggplot(VE2, aes(x=Conc, y= Percent, color = SampleID, alpha =0.6)) +
#       guides(color =  "none", alpha = "none")+
#           stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom = "errorbar", size =1, width = .1)+
#     stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,0,1,NA))), se = FALSE)+
#       ylim(0,1.5)+
#       scale_x_log10() +  # Change the x-axis scale to log 10 scale
#   theme_classic() +
#   xlab(expression(paste("Concentration [", mu, "M]")))+
#   ylab("Normalized Cell Viability")+
#       theme(plot.title = element_text(hjust = 0.5, size =20))+
#       ggtitle("Control")
veplot <- 
  ggplot(VE2, aes(x = Conc,y = Percent,color = SampleID,alpha = 0.6)) +
      guides(color="none", alpha = "none")+
      stat_summary(fun.data=mean_se, 
                   fun.args = list(mult=1), 
                   geom = "errorbar", 
                   size =.5, 
                   width = .1)+
      stat_smooth(method = "drm", method.args = list(fct = L.4(c(NA,0,1,NA))), se = FALSE)+
      ylim(0,1.5)+
      scale_color_brewer(palette = "Dark2")+
      scale_x_log10() +  # Change the x-axis scale to log 10 scale
      theme_classic() +
      xlab(expression(paste("Concentration [", mu, "M]"))) +
      ylab(NULL) +
      ggtitle("Vehicle") +
      theme(plot.title = element_text(hjust = 0.5, size = 15, face = "bold")) +
      theme(
        axis.title = element_text(size = 10),
        axis.ticks = element_line(linewidth =  2),
        axis.text = element_text(size = 10, face = "bold"),
        panel.grid.major = element_line(colour = 'lightgrey'),
        panel.border = element_rect(fill = NA, linewidth = 2),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = "transparent", colour = NA))
    
veplot
# theme(plot.title = element_text(hjust = 0.5, size =20))
     #####plot all together!#####   


    
    ```
###plot all together!#####
    
```{r plot together not good, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
    library(cowplot)
## take a legend from a plot
legend_b <- ggpubr::get_legend(leg)

ggpubr::as_ggplot(legend_b)
legend_b

# plan1 <- plot_grid(daplot,dxplot,epplot,NULL,mtplot, trplot,veplot,legend_b,ncol =4)
plan2 <-  plot_grid(daplot,dxplot,epplot,mtplot, trplot,veplot,ncol =3)
  
#drcfinal<- plot_grid(plan1, ncol =1, rel_heights = c(1,0.1))
save_plot('output/plan2plot.png', plan2)
save_plot('individual-legenddark2.png',ggpubr::as_ggplot(legend_b))
plan2
plan48ldh
```
###LD50 extract


```{r  LD50 extraction make the list}

DAi <- full_list %>% dplyr::filter(Drug == "Daun")
DXi <- full_list %>% dplyr::filter(Drug == "Doxo")
EPi <- full_list %>% dplyr::filter(Drug =="Epi")
MTi <- full_list %>% filter(Drug =="Mito")
TRi <- full_list %>% filter(Drug =="Tras")
VEi <- full_list %>% filter(Drug == "Veh")
###extracting ggplot colors:
```


```{r extract the stuff via dr4pl, eval=FALSE, include=FALSE}

param_holder <- c()
for (i in ID) {
  thing <- filter(DAi, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- IC(thing.m, inhib.percent = c(50))
  
}  
daLD <- sapply(param_holder, "[[", 1) 

param_holder <- c()
for (i in ID) {
  thing <- filter(DXi, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
   param_holder[[i]] <- IC(thing.m, inhib.percent = c(50))
  
}  
dxLD <- sapply(param_holder, "[[", 1) 

param_holder <- c()
for (i in ID) {
  thing <- filter(EPi, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
    param_holder[[i]] <- IC(thing.m, inhib.percent = c(50))
  
}  
epLD <- sapply(param_holder, "[[", 1) 



param_holder <- c()
for (i in ID) {
  thing <- filter(MTi, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
    param_holder[[i]] <- IC(thing.m, inhib.percent = c(50))
  
}  
mtLD <- sapply(param_holder, "[[", 1) 


param_holder <- c()
for (i in ID) {
  thing <- filter(TRi, SampleID== i)
  thing.m <- dr4pl(Percent ~ Conc, 
                   data = thing, method.init = "logistic")
    param_holder[[i]] <- IC(thing.m, inhib.percent = c(50))
  
}  
trLD <- sapply(param_holder, "[[", 1) 


```
###drm extracting
```{r extracting with drm, echo=FALSE}
daunls <- list() ###daunorubicin list
doxols <- list() ### doxorubicin list
epils <- list() ###epirubicin list
mitols <- list() ###mitoxantrone list
trasls <- list() ###trastuzmab list
vehls <- list() ###vehicle list


for(k in ID){
thingda <-  filter(DAi, SampleID==k)
  thingda.m <- drm(Percent~Conc, data = thingda, fct=LL.4(c(NA, 0, 1, NA)))
  onion <- ED(thingda.m, c(50), interval = "delta")
  daunls[k] <- onion[1]
  print(paste0(k, " Daunorubicin"))
thingdx <-  filter(DXi, SampleID==k)
  thingdx.m <- drm(Percent~Conc, data = thingdx, fct=LL.4(c(NA, 0, 1, NA)))
  onionx <- ED(thingdx.m, c(50), interval = "delta")
  doxols[k] <- onionx[1]
  print(paste0(k, " Doxoorubicin"))
 thingep <-  filter(EPi, SampleID==k)
  thingep.m <- drm(Percent~Conc, data = thingep, fct=LL.4(c(NA, 0, 1, NA)))
  onione <- ED(thingep.m, c(50), interval = "delta")
  epils[k] <- onione[1] 
  print(paste0(k, " Epirubicin"))
  thingmt <-  filter(MTi, SampleID==k)
  thingmt.m <- drm(Percent~Conc, data = thingmt, fct=LL.4(c(NA, 0, 1, NA)))
  onionm <- ED(thingmt.m, c(50), interval = "delta")
  mitols[k] <- onionm[1] 
  print(paste0(k, " Mitoxantrone"))
  
 }



```
```{r DA try with drc, message=FALSE, warning=FALSE}
for(k in ID){

  thing <-  filter(DA, SampleID==k)
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, 0, NA, NA)))
  plot(thing.m, 
       type ="bars" ,
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
 
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  daunls[k] <- a[1]


 }

daunls
```



```{r DX try with drc, message=FALSE, warning=FALSE}
for(k in ID){

  thing <-  filter(DX, SampleID==k)  
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, 0, NA, NA)))
  plot(thing.m,
       type ="bars",
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
  
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  doxols[k] <- a[1]


 }

doxols
```


```{r EP try with drc, echo=FALSE, message=FALSE, warning=FALSE}
for(k in ID){

  thing <-  filter(EP, SampleID==k)  
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, 0, NA, NA)))
  plot(thing.m,
       type ="bars",
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
  
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  epils[[k]] <- a[[1]]


 }

epils
```
```{r MT try with drc, message=FALSE, warning=FALSE}

for(k in ID){

  thing <-  filter(MT, SampleID==k)  
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, 0, NA, NA)))
  plot(thing.m,
       type ="bars",
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
  
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  mitols[[k]] <- a[[1]]


 }

mitols
```

```{r TR try with drc, message=FALSE, warning=FALSE}
ID2 <- ID[c(-4,-9,-12)]

for(k in ID2){

  thing <-  filter(TR, SampleID==k)  
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, NA, NA, NA)))
  plot(thing.m,
       type ="bars",
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
  
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  trasls[[k]] <- a[[1]]


 }

trasls
```

```{r VE try with drc}
for(k in ID){

  thing <-  filter(VE, SampleID==k)
  na.omit= TRUE
  thing.m <- drm(Percent~Conc, data = thing, fct=LL.4(c(NA, NA, NA, NA)))
  plot(thing.m, 
       type ="bars" ,
       main = paste(thing$Name[1], " ", k),
       col= 2,
       xlab = expression(paste("Concentration [",mu,"M]")),
       ylab = "Percent Viable",
       ylim=c(0,1.5))
  plot(thing.m,  type="bars", col= 2, add=TRUE )
  
  a <- ED(thing.m, c(50), interval = "delta")
  legend("topright", legend = paste(round(a[1],2)))
  vehls[k] <- a[[1]]


 }

vehls
```








##ld50 condensed


```{r combine LD50 values}
###combining all values into a larger dataframe


daunls <- plyr::quickdf(daunls) %>% 
  pivot_longer(everything(),names_to = 'indv', values_to = "Daun")
                        
doxols <- plyr::quickdf(doxols) %>% 
  pivot_longer(everything(),names_to = 'indv', values_to = "Doxo")
epils <- plyr::quickdf(epils)%>% 
  pivot_longer(everything(),names_to = 'indv', values_to = "Epi")
mitols <- plyr::quickdf(mitols)%>% 
  pivot_longer(everything(), names_to = 'indv', values_to = "Mito")

LDfull <- right_join(daunls,doxols,by = 'indv') %>% right_join(.,epils,by = 'indv') %>% right_join(., mitols, by= 'indv')

meanLDfull <- LDfull %>% mutate(indv = c('1','1','2','2','3','3','4','4','5','5','6','6')) %>% 
pivot_longer(.,col=!indv,names_to = 'Treatment',values_to = 'LD50') 


avgLD50 <- aggregate(LD50~Treatment+indv, data= meanLDfull, mean)
saveRDS(avgLD50,"data/avgLD50.RDS")

LDfull <- right_join(daunls,doxols,by = 'indv') %>% right_join(.,epils,by = 'indv') %>% right_join(., mitols, by= 'indv')
colnames(LDfull) <- c("indv","Daunorubicin", "Doxorubicin", "Epirubicin", "Mitoxantrone")
summary(LDfull)


  
avgLD50 %>% mutate(Treatment=case_match(Treatment,"Daun"~"Daunorubicin",
                         "Doxo"~"Doxorubicin",
                         "Epi"~"Epirubicin",
                         "Mito"~"Mitoxantrone",
                         "Tras"~"Trastuzumab",
                         "Veh"~ "Control", .default= Treatment)) %>% 
    mutate(indv= factor(indv)) %>% 
  ggplot(., (aes(x = (Treatment), y = log10(LD50)))) +
  geom_boxplot(position = "identity",aes(fill=Treatment))+
  geom_point(aes(color = indv,
                 size = 5,alpha = 0.5)) +
  ggtitle("Observed LD 50s")+
  xlab("Treatment")+
  ylab(bquote('Log'[10]~ 'LD'[50]~'in '*mu~mol))+
  scale_color_brewer(palette = "Dark2",
                     name = "Individual", 
                     labels = c("1","2","3","4","5","6"))+
  scale_fill_manual(values=drug_palc)+
  theme_bw() + 
  theme(plot.title = element_text(hjust =0.5, size = 18))+
  guides(alpha ="none", size = "none", fill= "none")+
  #theme(strip.background = element_rect(fill = "transparent")) +
  theme(plot.title = element_text(size = rel(1.5), hjust = 0.5),
        legend.position = "none",
         axis.title = element_text(size = 15, color = "black"),
        axis.ticks = element_line(linewidth = 1.5),
        axis.line = element_line(linewidth = 1.5),
        axis.text = element_text(size = 12, color = "black", angle = 0),
        strip.text.x = element_text(size = 15, color = "black", face = "bold")) %>% print()  
  
```

###barplot for poster

```{r barplot}

#mean_values <-  abc_df %>% mutate("Indiv" = substr(SampleID,4,4)) %>% 
 # dplyr::group_by(SampleID, Drug, Conc)  
  
in78 <- abc_df %>% 
  dplyr::filter(Drug=="Veh"|Drug =="Doxo") %>%
  filter(SampleID=="ind5a") %>%  
  filter(Conc ==1|Conc==0.5)


veh78 <- in78 %>% filter(Drug =="Veh") %>% mutate(Conc = 0*Conc)
dox78 <- in78 %>% filter(Drug =="Doxo")
in78 <- rbind(veh78,dox78)
in78a <- in78 %>% dplyr::select (Percent, Conc) %>% mutate(as.factor(Conc))


ggplot(Test, aes(y=Percent, x=factor(Conc),fill =factor(Conc)))+ 
  stat_summary(fun.data=mean_sdl, geom="bar")+
  stat_summary(fun.data=mean_sdl, fun.args= list(mult =1), 
               geom="errorbar", width=0.3)+
    theme_bw() +ylim(c(0, 1.5))+
  scale_fill_manual(values= c( "orange","red","purple")) +
  #scale_fill_discrete(values =c("red","purple",))+
  labs(title = "Doxorubicin")+ 
  xlab(expression(paste("Drug concentration [", mu, "M]")))+
  ylab("Average Viability")+
  theme(plot.title = element_text(hjust =0.5, size = 18, face="bold"))+
  guides(fill ="none")+
    theme(axis.title=element_text(size=15, color ="black"),
        axis.ticks=element_line(size =2),
        axis.text=element_text(size=15, face = "bold", color ="black"),
        panel.border=element_rect(fill = NA, size = 3))




in78$Percent
in78$Conc

barplot()

summarise(in78)
Test <- c()
Test$Conc <- c(0.0, 0.0, 0.0, 0.0 ,0.0 ,0.0 ,0.0 ,0.0, 1.0, 1.0, 1.0, 0.5, 1.0 ,0.5, 0.5 ,0.5, 0.5)

Test$Percent <- c(0.8613429, 0.9125987 ,0.9434696, 0.9939936 ,1.0131610, 1.0171015, 1.1307707, 1.1275620 ,0.4203752 ,0.5095490 ,0.5525790,0.6806332, 0.6934852, 0.8022452,
0.8758142, 1.0392211,1.0847938)
Test <- as.data.frame(Test)


```

fsys got 
##Data for Troponin I release after 0.5 uM treatment at 3 hours and 24 hours


```{r   Troponin i echo=FALSE, warnings = FALSE}
# ###make data frame
dn <- c('Vehicle', 'Daunorubicin', 'Doxorubicin', 'Epirubicin', 'Mitoxantrone', 'Trastuzumab','Vehicle', 'Daunorubicin', 'Doxorubicin', 'Epirubicin', 'Mitoxantrone', 'Trastuzumab')
# 
# ng <- c(9615.9,7800.61,3454.27,6171.64,4276.96,11619.86,5237.35,19541.6,16257.39,21097.08,21774.27,26494.72)
# relng <- c(1.003,0.814,0.359,0.628,0.433,1.211,0.921,3.437,2.808,3.712,3.831,4.658)
# relstdv <- c(0.005,0.035,0.097,0.401,0.301,0.129,0.112,0.233,1.547,0.084,0.123,0.533)
# stdv <- c(43,339,930,3845,2886,1241,638,1327,8791,480,698,3027)
# hrs <- c((rep(3,6)), (rep(24,6)))
# 
tidata <- data.frame(dn, relng, relstdv, hrs)
# 
# 
# ##make the plot##

tropimage <- ggplot(tidata, aes(factor (dn, level = c('Vehicle', 'Daunorubicin', 'Doxorubicin', 'Epirubicin', 'Mitoxantrone', 'Trastuzumab')), y = relng, group = hrs, fill = as.factor(hrs)))+ 
  geom_bar(position = "dodge", stat = "identity")+
  scale_fill_manual(values= c( "dark green","purple4")) +
  ggtitle("Levels of Troponin I release in cell media")+
  theme_bw() +
   xlab("Treatment at 0.5 uM")+
  ylab("Relative Units")+
  scale_y_continuous(
    # don't expand y scale at the lower end
    expand = expansion(mult = c(0, 0.05)))+
  labs(fill = "Hours")+
  theme(axis.title=element_text(size=15, color ="black"),
        plot.title = element_text(hjust =0.5, size = 18),
        axis.ticks=element_line(size =1.5),
        axis.text=element_text(size=9, color ="black"),
        panel.border=element_rect(fill = NA, size = 2))+ 
      #axis.text.y = element_text(angle=45, vjust=1.1, hjust=0.5))+
  geom_errorbar(aes(ymin=relng, ymax=relng+relstdv), width=.2,
                 position=position_dodge(.9))

tropimage 
save_plot("tropimage.png",tropimage)






```
###LDH DATA ###

```{r}
library(tidyverse)
#my_comparisons <- 
  
  
# ggplot(sig_analysis, aes(x = as.factor(Conc), y = norm_val, group = Conc)) +
#   geom_boxplot(aes(fill = as.factor(Conc))) +
#   #geom_point(aes(color= indv))+
#   stat_compare_means(method="t.test", ref.group=1, label="p",angle = 75,hide.ns = TRUE, label.y=c(4.5),label.x= c(1.5,2.5,3.5,4.5,5.5,6.5,7.5),aes(angle=90))+
#     scale_fill_manual(values = c("#F3BABD","#EAA2A5","#E28A8E",
#                 "#DA7277","#CF5157","#C43138","#982124","#6B1210" ),
#     aesthetics = c("Conc", "fill")) + 
#       guides(fill = FALSE) +
#       #geom_hline(yintercept = 1) +
#       theme_bw() +
#       xlab(expression(paste("Drug [", mu, "M]"
#       ))) +
#       ylab("LDH release") +
#       labs(fill = "Individual") +
#       facet_wrap("Drug") +
#       theme(strip.background = element_blank()) +
#       theme(
#         axis.title = element_text(size = 15, color = "black"),
#         axis.ticks = element_line(size = 1.5),
#         axis.text = element_text(size = 9, color = "black", angle = 20),
#         panel.border = element_rect(fill = NA, size = 2),
#         panel.background = element_rect(fill = "transparent"),
#         plot.background = element_rect(fill = "transparent", colour = NA),
#         strip.text.x = element_text(size = 15, color = "black", face = "bold")) 
#       
```












 ylab("Relative to Control Cells") +
      # labs(fill = "Concentration") +
      # show.legend = FALSE +
      # facet_wrap("Drug") +
      # theme(
      #   legend.posistion = "none" ,
      #   strip.background = element_blank(),
      #   strip.placement = "outside",
      #   axis.title = element_text(size = 15, color = "black"),
      #   axis.ticks = element_line(size = 1.5),
      #   axis.text = element_text(size = 10, color = "black"),
        
    
png("tropimage.png")
print(tropimage)
 dev.off()
library(magrittir)
selecting and redoing analysis
ldhresults
ldhnew <- select(ldhresults, c(indv,Drug,Conc,rLDH)) 
colnames(ldhnew)
wideldh <- pivot_wider(ldhnew, -id_cols=c(Drug,indv),id_expand= TRUE,names_from =Conc, values_from = c(rLDH))

ave_ldh <- ldhnew %>%  group_by(Drug,Conc) %>%
  summarise_at(vars(rLDH), list(name = mean)) %>% filter(Drug=="Control")

atest 
 )save_plot('tranparentLDH.png', atest)
 atest 
 tag_facet(atest)
 atest
library(egg)
library(tidyverse)
library(dplyr)
```










