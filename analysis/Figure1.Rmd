---
title: "Figure 1: TOP2i drugs affect cardiomyocyte viability in a dose-dependent manner"
author: "ERM"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

```{css, echo=FALSE}
pre {
  max-height: 400px;
  overflow-y: auto;
}

pre[class] {
  max-height: 200px;
}
```

```{r packages loading}
library(car)
library(tidyverse)
library(tinytex)
library(BiocGenerics)
library(data.table)
library(drc)
library(cowplot)
library(ggsignif)
library(RColorBrewer)
library(broom)
library(ComplexHeatmap)
```

## Figure 1

Top2i drugs affect cardiomyocyte viability in a dose-dependent manner.

### A. Project overview: Image not given here. Please look at our paper.

### B. Dose-response curves from 48 hour drug exposure.

```{r B drc, fig.width=12, fig.height=3}
daplot <- readRDS("output/daplot.RDS")  
dxplot <- readRDS("output/dxplot.RDS")
epplot<- readRDS("output/epplot.RDS")
mtplot<- readRDS("output/mtplot.RDS")
trplot<- readRDS("output/trplot.RDS")
veplot<- readRDS("output/veplot.RDS")
veplot <- veplot+xlab(NULL)
trplot <- trplot+xlab(NULL)
legend_b <- readRDS("output/legend_b.RDS")
plan2 <-  cowplot::plot_grid(daplot,dxplot,epplot,mtplot, trplot,veplot, legend_b,ncol =7, rel_widths = c(1,1,1,1,1,1,.5))
print(plan2)
```

Lines are a 4 point log-logistic regression of the mean from two biological replicates for each individual at 8 concentrations for each condition, except(trastuzmab)TRZ, which is 7 concentrations.

You can find the link to initial DRC analysis at this[link](https://mward-lab.github.io/Matthews_TOP2i_cardiotox_2023/DRC_analysis.html#Ploting_the_DRC)

```{r LD50}
drug_palc <- c("#8B006D","#DF707E","#F1B72B", "#3386DD","#707031","#41B333")
BC_cell_lines <- read.csv("data/BC_cell_lines.csv",row.names = 1)
LD50_table <- readRDS("data/new_ld50avg.RDS")



graphLD50 <- LD50_table %>%
  mutate(Treatment = factor(Treatment,
                            levels = c('DOX', 'EPI', 'DNR', 'MTX', 'TRZ', 'VEH'))) %>%
  ggplot(., (aes(x = Treatment, y = log10(Estimate)))) +
  geom_boxplot(position = "identity", aes(fill = Treatment)) +
  geom_point(aes(
    color = indv,
    size = 5,
    alpha = 0.5
  )) +
  ggtitle(expression("Experimentally-derived LD"[50] * "s\n from treated cardiomyocytes")) +
  xlab("") +
  geom_signif(
    comparisons = list(
      c("DNR", "MTX"),
      c("DOX", "EPI"),
      c ("DOX", "DNR"),
      c("DOX", "MTX")
    ),
    test = "t.test",
    map_signif_level = TRUE,
    textsize = 4,
    step_increase = 0.15
  ) +
  ylab(bquote('Log'[10] ~ 'LD'[50] ~ 'in ' * mu * M)) +
  scale_color_brewer(palette = "Dark2",
                     name = "Individual") +
  ylim(-2, 3) +
  
  scale_fill_manual(values = drug_palc, name = "Treatment") +
  theme_bw() +
  guides(alpha = "none", size = "none") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12),
    axis.title = element_text(size = 15, color = "black"),
    axis.ticks = element_line(linewidth = 1.5),
    axis.line = element_line(linewidth = 1.5),
    axis.text.x = element_text(size = 0, color = "white"),
    # axis.text = element_text(size = 12, color = "black", angle = 0),
    strip.text.x = element_text(
      size = 15,
      color = "black",
      face = "bold"
    )
  )   
```

You can find the links to DRC and BCC analysis at this[link](https://mward-lab.github.io/Matthews_TOP2i_cardiotox_2023/DRC_analysis.html#LD50_correlation).

### C & D. LD~50~ and EC~50~

```{r BCcells ld50,fig.width=12, fig.height=5}

graphBC <-
  BC_cell_lines %>%
  mutate(Cell_line = factor(Cell_line)) %>%
  pivot_longer(.,
               col = !Cell_line,
               names_to = 'drug',
               values_to = 'LD50') %>%
  mutate(
    drug = case_match(
      drug,
      "Daunorubicin" ~ "DNR",
      "Doxorubicin" ~ "DOX",
      "Epirubicin" ~ "EPI",
      "Mitoxantrone" ~ "MTX",
      "Trastuzumab" ~ "TRZ",
      "Vehicle" ~ "VEH",
      .default = drug
    )
  ) %>%
  mutate(drug = factor(drug,
                       levels = c('DOX', 'EPI', 'DNR', 'MTX', 'TRZ', 'VEH'))) %>%
  ggplot(., (aes(x = (drug), y = log10(LD50)))) +
  geom_boxplot(position = "identity", aes(fill = drug)) +
  geom_point(aes(
    color = Cell_line,
    size = 5,
    alpha = 0.5
  )) +
  ggtitle(expression("Breast cancer cell line reported  ED"[50] * "s")) +
  xlab("") +
  
  geom_signif(
    comparisons = list(c("DOX", "EPI"),
                       c ("DOX", "DNR"),
                       c("DOX", "MTX")),
    test = "t.test",
    map_signif_level = TRUE,
    textsize = 4,
    step_increase = 0.15
  ) +
  ylab(bquote('Log'[10] ~ 'LD'[50] ~ 'in ' * mu * M)) +
  scale_color_brewer(palette = "Spectral",
                     name = "Cell lines") +
  scale_fill_manual(values = drug_palc) +
  ylim(-2, 3) +
  theme_bw() +
  guides(alpha = "none", size = "none", fill = "none") +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12),
    axis.title = element_text(size = 15, color = "black"),
    axis.ticks = element_line(linewidth = 1.5),
    axis.line = element_line(linewidth = 1.5),
    axis.text.x = element_text(size = 0, color = "white"),
    # axis.text = element_text(size = 12, color = "black", angle = 0),
    strip.text.x = element_text(
      size = 15,
      color = "black",
      face = "bold"
    )
  )
# graphBC
plan50ld <-
  cowplot::plot_grid(graphLD50,
                     NULL,
                     graphBC,
                     rel_widths = c(1, .2, 1),
                     nrow = 1)
print(plan50ld)
  
```

You can find the code to EC50 breast cancer cell lines at this [link](https://mward-lab.github.io/Matthews_TOP2i_cardiotox_2023/DRC_analysis.html#LD50_by_avg_of_viability).

